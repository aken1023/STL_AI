# è¨“ç·´ç³»çµ±ç¨å æ¨¡å¼

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

STL ç‰©ä»¶è­˜åˆ¥ç³»çµ±æ¡ç”¨**ç¨å è¨“ç·´æ¨¡å¼**ï¼Œä¸€æ¬¡åªå…è¨±ä¸€å€‹ç”¨æˆ¶é€²è¡Œè¨“ç·´ï¼Œç¢ºä¿è¨“ç·´å“è³ªå’ŒGPUè³‡æºä¸è¢«ç“œåˆ†ã€‚

## âœ¨ ä¸»è¦ç‰¹æ€§

### 1. ç¨å è¨“ç·´æ¨¡å¼
- âœ… ä¸€æ¬¡åªå…è¨±ä¸€å€‹ç”¨æˆ¶è¨“ç·´
- âœ… å…¶ä»–ç”¨æˆ¶å˜—è©¦è¨“ç·´æ™‚æœƒè¢«é˜»æ­¢
- âœ… æ¯å€‹ç”¨æˆ¶æœ‰ç¨ç«‹çš„è¨“ç·´æœƒè©±ID
- âœ… è‡ªå‹•æœƒè©±ç®¡ç†å’Œæ¸…ç†

### 2. æ™ºèƒ½é˜»æ­¢ç³»çµ±
- âš ï¸ æª¢æ¸¬æ­£åœ¨é‹è¡Œçš„è¨“ç·´ä»»å‹™
- âš ï¸ é˜»æ­¢ç¬¬äºŒå€‹ç”¨æˆ¶é–‹å§‹è¨“ç·´
- âš ï¸ é¡¯ç¤ºæ­£åœ¨è¨“ç·´çš„ç”¨æˆ¶IP
- âš ï¸ æä¾›å‹å¥½çš„éŒ¯èª¤è¨Šæ¯å’Œå½ˆçª—

### 3. å³æ™‚æ—¥èªŒè¼¸å‡º
- ğŸ“Š è¨“ç·´éç¨‹å³æ™‚æ—¥èªŒé¡¯ç¤º
- ğŸ“ˆ Epoch é€²åº¦å¯¦æ™‚æ›´æ–°
- ğŸ¯ æ¯å€‹ç”¨æˆ¶çœ‹åˆ°è‡ªå·±çš„è¨“ç·´æ—¥èªŒ

## ğŸ”§ æŠ€è¡“å¯¦ç¾

### æ¶æ§‹è¨­è¨ˆ
```
web_interface.py (ä¸»ç¨‹å¼)
  â”œâ”€â”€ training_sessions{} - å¤šç”¨æˆ¶æœƒè©±å­˜å„²
  â”œâ”€â”€ training_lock - ç·šç¨‹å®‰å…¨é–
  â””â”€â”€ multi_user_training.py - è¨“ç·´ç®¡ç†æ¨¡çµ„
```

### æœƒè©±ç®¡ç†
```python
training_sessions = {
    "220.133.237.24_1759219577773": {
        "client_ip": "220.133.237.24",
        "status": {training_status},
        "process": subprocess.Popen(...),
        "created_at": 1759219577.773
    },
    ...
}
```

### æœƒè©±IDç”Ÿæˆ
```python
session_id = f"{client_ip}_{int(time.time() * 1000)}"
# ç¯„ä¾‹: "220.133.237.24_1759219577773"
```

## ğŸ“¡ API æ›´æ–°

### POST /api/start_training
**è«‹æ±‚**:
```json
{
    "training_methods": {"yolo": true, "faiss": false},
    "yolo_config": {"epochs": 50, "batch_size": 16}
}
```

**æˆåŠŸå›æ‡‰**:
```json
{
    "success": true,
    "message": "å¤šæ¨¡å‹è¨“ç·´å·²å•Ÿå‹•",
    "session_id": "220.133.237.24_1759219577773",
    "active_sessions": 1
}
```

**å¤±æ•—å›æ‡‰ï¼ˆå…¶ä»–ç”¨æˆ¶æ­£åœ¨è¨“ç·´ï¼‰**:
```json
{
    "success": false,
    "error": "è¨“ç·´ç³»çµ±æ­£åœ¨ä½¿ç”¨ä¸­",
    "message": "å¦ä¸€å€‹ç”¨æˆ¶ï¼ˆ220.133.237.24ï¼‰æ­£åœ¨é€²è¡Œè¨“ç·´ï¼Œè«‹ç¨å¾Œå†è©¦",
    "other_user": "220.133.237.24",
    "retry_after": "è«‹ç­‰å¾…ç•¶å‰è¨“ç·´å®Œæˆ"
}
```

### GET /api/training_status
**å›æ‡‰**:
```json
{
    "is_training": true,
    "current_epoch": 5,
    "total_epochs": 50,
    "log_lines": [...],
    "active_sessions_count": 2,
    "session_id": "220.133.237.24_1759219577773"
}
```

## ğŸ¨ ç”¨æˆ¶é«”é©—

### è¨“ç·´å•Ÿå‹•æµç¨‹ï¼ˆæˆåŠŸï¼‰
1. ç”¨æˆ¶Aé»æ“Šã€Œæ­£å¸¸è¨“ç·´ã€
2. ç³»çµ±æª¢æ¸¬æ²’æœ‰å…¶ä»–è¨“ç·´
3. å‰µå»ºæ–°çš„è¨“ç·´æœƒè©±
4. å•Ÿå‹•è¨“ç·´ä¸¦å¯¦æ™‚é¡¯ç¤ºæ—¥èªŒ

### è¨“ç·´é˜»æ­¢æµç¨‹ï¼ˆå¤±æ•—ï¼‰
1. ç”¨æˆ¶Bé»æ“Šã€Œæ­£å¸¸è¨“ç·´ã€ï¼ˆæ­¤æ™‚ç”¨æˆ¶Aæ­£åœ¨è¨“ç·´ï¼‰
2. ç³»çµ±æª¢æ¸¬åˆ°ç”¨æˆ¶Aæ­£åœ¨è¨“ç·´
3. **æ‹’çµ•ç”¨æˆ¶Bçš„è«‹æ±‚**
4. é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯å’Œå½ˆçª—
5. ç”¨æˆ¶Béœ€è¦ç­‰å¾…ç”¨æˆ¶Aå®Œæˆ

### éŒ¯èª¤è¨Šæ¯ç¯„ä¾‹
```
âŒ è¨“ç·´å•Ÿå‹•å¤±æ•—: è¨“ç·´ç³»çµ±æ­£åœ¨ä½¿ç”¨ä¸­
âš ï¸ ç³»çµ±ç›®å‰æ­£åœ¨ä½¿ç”¨ä¸­
ğŸ‘¤ ç”¨æˆ¶ 220.133.237.24 æ­£åœ¨é€²è¡Œè¨“ç·´
â° è«‹ç­‰å¾…ç•¶å‰è¨“ç·´å®Œæˆå¾Œå†è©¦
ğŸ’¡ æç¤ºï¼šè¨“ç·´å®Œæˆå¾Œç³»çµ±æœƒè‡ªå‹•é‡‹æ”¾
```

### å½ˆçª—è¨Šæ¯
```
âš ï¸ è¨“ç·´ç³»çµ±æ­£åœ¨ä½¿ç”¨ä¸­

ç”¨æˆ¶ 220.133.237.24 æ­£åœ¨é€²è¡Œè¨“ç·´

è«‹ç­‰å¾…ç•¶å‰è¨“ç·´å®Œæˆå¾Œå†è©¦
```

## ğŸ”’ ç·šç¨‹å®‰å…¨

ä½¿ç”¨ `threading.Lock()` ç¢ºä¿ï¼š
- æœƒè©±å‰µå»º/åˆªé™¤çš„åŸå­æ€§
- ç‹€æ…‹è®€å¯«çš„ä¸€è‡´æ€§
- å¤šç·šç¨‹è¨ªå•çš„å®‰å…¨æ€§

## ğŸ“Š è³‡æºç®¡ç†

### GPU è³‡æºå…±äº«
- å¤šå€‹è¨“ç·´åŒæ™‚é‹è¡Œæœƒå…±äº«GPU
- ç³»çµ±æœƒæç¤ºç”¨æˆ¶å¯èƒ½çš„é€Ÿåº¦å½±éŸ¿
- å»ºè­°ï¼šç”Ÿç”¢ç’°å¢ƒé™åˆ¶ä¸¦ç™¼æ•¸é‡

### è¨˜æ†¶é«”ç®¡ç†
- æ¯å€‹æœƒè©±ä¿ç•™æœ€æ–°200è¡Œæ—¥èªŒ
- è‡ªå‹•æ¸…ç†å®Œæˆçš„è¨“ç·´æœƒè©±
- é˜²æ­¢è¨˜æ†¶é«”æ´©æ¼

## ğŸš€ ä½¿ç”¨å»ºè­°

### é©åˆå ´æ™¯
- âœ… å–®ç”¨æˆ¶ç¨å GPUè³‡æº
- âœ… ç¢ºä¿è¨“ç·´å“è³ªå’Œé€Ÿåº¦
- âœ… é¿å…è³‡æºç«¶çˆ­
- âœ… åœ˜éšŠè¼ªæµä½¿ç”¨

### å„ªé»
- ğŸ¯ è¨“ç·´å“è³ªæœ‰ä¿è­‰
- ğŸš€ GPUä¸æœƒè¢«ç“œåˆ†
- ğŸ”’ é¿å…è³‡æºè¡çª
- ğŸ“Š è¨“ç·´é€Ÿåº¦æœ€å„ª

### æ³¨æ„äº‹é …
- â° éœ€è¦æ’éšŠç­‰å¾…
- ğŸ‘¥ åŒä¸€æ™‚é–“åªæœ‰ä¸€äººå¯è¨“ç·´
- ğŸ’¡ å»ºè­°åˆç†å®‰æ’è¨“ç·´æ™‚é–“

## ğŸ“ é–‹ç™¼æ—¥èªŒ

### 2025-09-30 æ›´æ–°
- âœ… å¯¦ç¾ç¨å è¨“ç·´æ¨¡å¼
- âœ… æ·»åŠ ç”¨æˆ¶é˜»æ­¢ç³»çµ±
- âœ… å„ªåŒ–æ—¥èªŒå³æ™‚è¼¸å‡º
- âœ… æ”¹é€²ç·šç¨‹å®‰å…¨æ©Ÿåˆ¶
- âœ… æ·»åŠ å‹å¥½çš„éŒ¯èª¤æç¤ºå’Œå½ˆçª—

### æ ¸å¿ƒé‚è¼¯
```python
# æª¢æŸ¥æ˜¯å¦æœ‰å…¶ä»–ç”¨æˆ¶æ­£åœ¨è¨“ç·´
if len(active_sessions) > 0:
    current_training = active_sessions[0]
    if current_training['client_ip'] != client_ip:
        # æ‹’çµ•ç¬¬äºŒå€‹ç”¨æˆ¶
        return jsonify({
            'success': False,
            'error': 'è¨“ç·´ç³»çµ±æ­£åœ¨ä½¿ç”¨ä¸­',
            'other_user': other_user_ip
        })
```

## ğŸ”® æœªä¾†è¦åŠƒ

- [ ] è¨“ç·´éšŠåˆ—ç³»çµ±ï¼ˆè‡ªå‹•æ’éšŠï¼‰
- [ ] é ç´„è¨“ç·´æ™‚é–“
- [ ] è¨“ç·´æ™‚é–“é™åˆ¶
- [ ] è¨“ç·´æ­·å²è¨˜éŒ„
- [ ] Emailé€šçŸ¥åŠŸèƒ½