<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>測試覆蓋層</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container mt-5">
        <h1>測試訓練覆蓋層</h1>
        <button class="btn btn-primary btn-lg" onclick="showTrainingOverlay()">顯示訓練覆蓋層</button>
        <button class="btn btn-secondary btn-lg ms-2" onclick="hideTrainingOverlay()">隱藏覆蓋層</button>
        <button class="btn btn-danger btn-lg ms-2" onclick="removeTrainingOverlay()">移除覆蓋層</button>
    </div>

    <script>
        // 顯示全屏訓練中覆蓋層
        function showTrainingOverlay() {
            console.log('🎯 showTrainingOverlay() 被調用');

            // 移除舊的覆蓋層（如果存在）
            const oldOverlay = document.getElementById('trainingOverlay');
            if (oldOverlay) {
                console.log('移除舊的覆蓋層');
                oldOverlay.remove();
            }

            // 創建覆蓋層
            const overlay = document.createElement('div');
            overlay.id = 'trainingOverlay';
            overlay.style.cssText = `
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                background: rgba(0, 0, 0, 0.85) !important;
                z-index: 999999 !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                backdrop-filter: blur(8px) !important;
                -webkit-backdrop-filter: blur(8px) !important;
            `;

            // 創建內容容器
            const content = document.createElement('div');
            content.style.cssText = `
                text-align: center;
                color: white;
                padding: 50px 60px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border-radius: 20px;
                box-shadow: 0 20px 60px rgba(0,0,0,0.5);
                max-width: 700px;
                width: 90%;
                max-height: 90vh;
                overflow-y: auto;
                z-index: 1000000;
                position: relative;
            `;

            content.innerHTML = `
                <div class="spinner-border text-light mb-4" role="status" style="width: 5rem; height: 5rem;">
                    <span class="visually-hidden">訓練中...</span>
                </div>
                <h3 class="text-white mb-4">🚀 模型訓練進行中</h3>

                <!-- 訓練進度 -->
                <div class="mb-4">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="text-white-50">訓練進度</span>
                        <span class="text-white fw-bold" id="overlayEpochText">Epoch 25/100</span>
                    </div>
                    <div class="progress" style="height: 25px; background: rgba(255,255,255,0.2);">
                        <div id="overlayProgressBar" class="progress-bar progress-bar-striped progress-bar-animated"
                             role="progressbar" style="width: 25%; background: linear-gradient(90deg, #28a745, #20c997);">
                            <span id="overlayProgressText" class="fw-bold">25%</span>
                        </div>
                    </div>
                </div>

                <!-- 訓練詳情 -->
                <div class="row text-start mb-4">
                    <div class="col-6 mb-3">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-clock me-2" style="font-size: 1.5rem; opacity: 0.7;"></i>
                            <div>
                                <small class="text-white-50 d-block">已用時間</small>
                                <span class="text-white fw-bold" id="overlayElapsedTime">00:15:30</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 mb-3">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-hourglass-half me-2" style="font-size: 1.5rem; opacity: 0.7;"></i>
                            <div>
                                <small class="text-white-50 d-block">預計剩餘</small>
                                <span class="text-white fw-bold" id="overlayRemainingTime">約 45 分鐘</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-chart-line me-2" style="font-size: 1.5rem; opacity: 0.7;"></i>
                            <div>
                                <small class="text-white-50 d-block">當前損失</small>
                                <span class="text-white fw-bold" id="overlayLoss">0.3542</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-bullseye me-2" style="font-size: 1.5rem; opacity: 0.7;"></i>
                            <div>
                                <small class="text-white-50 d-block">準確率</small>
                                <span class="text-white fw-bold" id="overlayAccuracy">87.5%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 當前狀態 -->
                <div class="mb-4 p-3" style="background: rgba(255,255,255,0.1); border-radius: 10px;">
                    <small class="text-white-50 d-block mb-1">當前狀態</small>
                    <div class="text-white" id="overlayStatus" style="font-size: 0.95rem;">正在訓練第 25 輪 (25%) - 模型正在穩定收斂中</div>
                </div>

                <!-- 最近日誌 -->
                <div class="mb-4 p-3 text-start" style="background: rgba(0,0,0,0.3); border-radius: 10px; max-height: 150px; overflow-y: auto;">
                    <small class="text-white-50 d-block mb-2">📋 最近日誌</small>
                    <div id="overlayRecentLogs" style="font-family: monospace; font-size: 0.85rem; color: #e0e0e0;">
                        <div style="margin-bottom: 4px; border-left: 2px solid rgba(255,255,255,0.3); padding-left: 8px;">📍 Epoch 25/100 (25%) | Loss: 0.3542</div>
                        <div style="margin-bottom: 4px; border-left: 2px solid rgba(255,255,255,0.3); padding-left: 8px;">⚡ 訓練速度: 2.5s/epoch</div>
                        <div style="margin-bottom: 4px; border-left: 2px solid rgba(255,255,255,0.3); padding-left: 8px;">💓 訓練運行中...</div>
                    </div>
                </div>

                <!-- 操作按鈕 -->
                <div class="d-flex gap-2 justify-content-center">
                    <button class="btn btn-outline-light btn-sm" onclick="hideTrainingOverlay()">
                        <i class="fas fa-eye-slash"></i> 最小化
                    </button>
                    <button class="btn btn-outline-danger btn-sm" onclick="alert('停止訓練功能')">
                        <i class="fas fa-stop"></i> 停止訓練
                    </button>
                </div>

                <div class="mt-3">
                    <small class="text-white-50">
                        <i class="fas fa-info-circle"></i> 訓練期間請勿關閉頁面
                    </small>
                </div>
            `;

            overlay.appendChild(content);
            document.body.appendChild(overlay);

            console.log('✅ 覆蓋層已添加到 body，元素ID:', overlay.id);
            console.log('覆蓋層 z-index:', overlay.style.zIndex);
            console.log('覆蓋層 display:', overlay.style.display);

            // 強制顯示
            setTimeout(() => {
                const check = document.getElementById('trainingOverlay');
                if (check) {
                    console.log('✅ 確認覆蓋層存在於 DOM 中');
                } else {
                    console.error('❌ 覆蓋層未找到！');
                }
            }, 100);
        }

        // 隱藏訓練覆蓋層（但不停止訓練）
        function hideTrainingOverlay() {
            const overlay = document.getElementById('trainingOverlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
        }

        // 移除訓練覆蓋層（訓練結束時）
        function removeTrainingOverlay() {
            const overlay = document.getElementById('trainingOverlay');
            if (overlay) {
                overlay.remove();
            }
        }
    </script>
</body>
</html>