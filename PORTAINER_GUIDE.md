# ğŸ³ Portainer ç®¡ç†æŒ‡å—

## ğŸ“ å¦‚ä½•åœ¨ Portainer æ‰¾åˆ° STL ç‰©ä»¶è­˜åˆ¥ç³»çµ±å®¹å™¨

### æ–¹æ³•ä¸€ï¼šé€éå®¹å™¨åˆ—è¡¨ï¼ˆæ¨è–¦ï¼‰

1. **ç™»å…¥ Portainer**
   ```
   é è¨­ä½å€ï¼šhttp://localhost:9000
   æˆ–æ‚¨çš„ä¼ºæœå™¨ï¼šhttp://your-server:9000
   ```

2. **å°èˆªåˆ°å®¹å™¨é é¢**
   ```
   å·¦å´é¸å–® â†’ Environments â†’ local â†’ Containers
   ```

3. **æ‰¾åˆ°å®¹å™¨**
   - å®¹å™¨åç¨±ï¼š`stl-object-detection`
   - æ˜ åƒåç¨±ï¼š`stl-detection:latest`
   - ç‹€æ…‹ï¼šæ‡‰é¡¯ç¤ºç¶ è‰²çš„ "running"
   - ç«¯å£ï¼š`0.0.0.0:8082 â†’ 8082/tcp`

### æ–¹æ³•äºŒï¼šé€éæœå°‹åŠŸèƒ½

1. åœ¨å®¹å™¨åˆ—è¡¨é é¢å³ä¸Šè§’æ‰¾åˆ°æœå°‹æ¡†
2. è¼¸å…¥ï¼š`stl` æˆ– `object-detection`
3. ç³»çµ±æœƒå³æ™‚éæ¿¾ä¸¦é¡¯ç¤ºåŒ¹é…çš„å®¹å™¨

### æ–¹æ³•ä¸‰ï¼šé€é Stack ç®¡ç†

å¦‚æœä½¿ç”¨ docker-compose éƒ¨ç½²ï¼š
```
å·¦å´é¸å–® â†’ Stacks â†’ stl (stack åç¨±)
```
æœƒçœ‹åˆ°è©² Stack ä¸‹çš„æ‰€æœ‰å®¹å™¨ã€‚

---

## ğŸ›ï¸ Portainer å®¹å™¨ç®¡ç†æ“ä½œ

### åŸºæœ¬æ“ä½œ

#### 1. æŸ¥çœ‹å®¹å™¨è©³ç´°è³‡è¨Š
```
é»æ“Šå®¹å™¨åç¨± â†’ é€²å…¥å®¹å™¨è©³æƒ…é é¢
```
é¡¯ç¤ºå…§å®¹ï¼š
- å®¹å™¨ç‹€æ…‹
- ç¶²è·¯è¨­å®š
- å·æ›è¼‰
- ç’°å¢ƒè®Šæ•¸
- è³‡æºä½¿ç”¨æƒ…æ³

#### 2. æŸ¥çœ‹å¯¦æ™‚æ—¥èªŒ
```
å®¹å™¨é é¢ â†’ Logs æ¨™ç±¤
```
åŠŸèƒ½ï¼š
- å¯¦æ™‚æ—¥èªŒä¸²æµ
- æ—¥èªŒæœå°‹
- è‡ªå‹•æ»¾å‹•
- è¤‡è£½æ—¥èªŒå…§å®¹

å¿«æ·éµï¼š
- `Ctrl + F`ï¼šæœå°‹æ—¥èªŒ
- å‹¾é¸ "Auto-refresh"ï¼šè‡ªå‹•åˆ·æ–°

#### 3. æŸ¥çœ‹å®¹å™¨çµ±è¨ˆè³‡è¨Š
```
å®¹å™¨é é¢ â†’ Stats æ¨™ç±¤
```
ç›£æ§é …ç›®ï¼š
- CPU ä½¿ç”¨ç‡
- è¨˜æ†¶é«”ä½¿ç”¨é‡
- ç¶²è·¯æµé‡ï¼ˆä¸Šå‚³/ä¸‹è¼‰ï¼‰
- I/O æ“ä½œ

#### 4. é€²å…¥å®¹å™¨çµ‚ç«¯
```
å®¹å™¨é é¢ â†’ Console æ¨™ç±¤
```
é¸é …ï¼š
- Commandï¼šé¸æ“‡ `/bin/bash` æˆ– `/bin/sh`
- Userï¼šé¸æ“‡ `root`
- é»æ“Š "Connect" é€²å…¥äº’å‹•å¼çµ‚ç«¯

å¸¸ç”¨å‘½ä»¤ï¼š
```bash
# æŸ¥çœ‹ Python é€²ç¨‹
ps aux | grep python

# æŸ¥çœ‹è¨“ç·´æ—¥èªŒ
tail -f web.log

# æª¢æŸ¥ç£ç¢Ÿä½¿ç”¨
df -h

# æŸ¥çœ‹ GPU ç‹€æ…‹ï¼ˆå¦‚æœ‰ï¼‰
nvidia-smi

# æ¸¬è©¦ API
curl http://localhost:8082/api/model_status
```

#### 5. é‡å•Ÿå®¹å™¨
```
å®¹å™¨åˆ—è¡¨ â†’ é¸ä¸­å®¹å™¨ â†’ Restart æŒ‰éˆ•
æˆ–
å®¹å™¨è©³æƒ…é é¢ â†’ é ‚éƒ¨ "Restart container" æŒ‰éˆ•
```

#### 6. åœæ­¢å®¹å™¨
```
å®¹å™¨åˆ—è¡¨ â†’ é¸ä¸­å®¹å™¨ â†’ Stop æŒ‰éˆ•
```

#### 7. å•Ÿå‹•å·²åœæ­¢çš„å®¹å™¨
```
å®¹å™¨åˆ—è¡¨ â†’ é¸ä¸­å®¹å™¨ â†’ Start æŒ‰éˆ•
```

---

## ğŸ” é€²éšåŠŸèƒ½

### 1. ç·¨è¼¯å®¹å™¨é…ç½®

```
å®¹å™¨è©³æƒ…é é¢ â†’ Duplicate/Edit æŒ‰éˆ•
```

å¯ä¿®æ”¹ï¼š
- ç’°å¢ƒè®Šæ•¸
- å·æ›è¼‰
- ç«¯å£æ˜ å°„
- è³‡æºé™åˆ¶
- ç¶²è·¯è¨­å®š

âš ï¸ **æ³¨æ„**ï¼šéœ€è¦åœæ­¢ä¸¦é‡æ–°å‰µå»ºå®¹å™¨æ‰èƒ½æ‡‰ç”¨æ›´æ”¹ã€‚

### 2. å‚™ä»½å®¹å™¨æ•¸æ“š

```bash
# åœ¨ Console ä¸­åŸ·è¡Œ
tar -czf /tmp/backup.tar.gz /app/runs /app/dataset

# ç„¶å¾Œåœ¨ä¸»æ©Ÿä¸‹è¼‰
docker cp stl-object-detection:/tmp/backup.tar.gz ./
```

### 3. ç›£æ§å®¹å™¨å¥åº·ç‹€æ…‹

```
å®¹å™¨è©³æƒ…é é¢ â†’ Health status
```
é¡¯ç¤ºï¼š
- å¥åº·æª¢æŸ¥ç‹€æ…‹ï¼ˆhealthy/unhealthyï¼‰
- æœ€å¾Œæª¢æŸ¥æ™‚é–“
- æª¢æŸ¥å¤±æ•—æ¬¡æ•¸

STL ç³»çµ±çš„å¥åº·æª¢æŸ¥ï¼š
```bash
curl -f http://localhost:8082/api/model_status
```

### 4. æŸ¥çœ‹å®¹å™¨è³‡æºé™åˆ¶

```
å®¹å™¨è©³æƒ…é é¢ â†’ Resources å€å¡Š
```
ç•¶å‰é…ç½®ï¼š
- CPUï¼š4 æ ¸å¿ƒä¸Šé™
- è¨˜æ†¶é«”ï¼š8GB ä¸Šé™

### 5. ç®¡ç†å®¹å™¨å·ï¼ˆVolumesï¼‰

```
å·¦å´é¸å–® â†’ Volumes
```
STL ç³»çµ±çš„è³‡æ–™å·ï¼š
- `./STL` â†’ STL æ¨¡å‹æª”æ¡ˆ
- `./dataset` â†’ è¨“ç·´åœ–ç‰‡
- `./yolo_dataset` â†’ YOLO æ ¼å¼è³‡æ–™é›†
- `./runs` â†’ è¨“ç·´çµæœ
- `./static/uploads` â†’ ä¸Šå‚³çš„åœ–ç‰‡

æ“ä½œï¼š
- ç€è¦½å·å…§å®¹
- ä¸‹è¼‰æª”æ¡ˆ
- åˆªé™¤å·

---

## ğŸš¨ æ•…éšœæ’æŸ¥

### å®¹å™¨ç„¡æ³•å•Ÿå‹•

1. **æŸ¥çœ‹æ—¥èªŒ**
   ```
   Containers â†’ stl-object-detection â†’ Logs
   ```
   å°‹æ‰¾éŒ¯èª¤è¨Šæ¯ï¼ˆç´…è‰²æ–‡å­—ï¼‰

2. **æª¢æŸ¥ç«¯å£è¡çª**
   ```
   Containers â†’ æª¢æŸ¥æ˜¯å¦æœ‰å…¶ä»–å®¹å™¨ä½¿ç”¨ 8082 ç«¯å£
   ```

3. **æª¢æŸ¥å·æ›è¼‰**
   ```
   å®¹å™¨è©³æƒ… â†’ Volumes æ¨™ç±¤
   ç¢ºèªæ‰€æœ‰ç›®éŒ„å­˜åœ¨ä¸”æœ‰æ­£ç¢ºæ¬Šé™
   ```

### å®¹å™¨é‹è¡Œä½†ç„¡æ³•è¨ªå•

1. **æª¢æŸ¥ç«¯å£æ˜ å°„**
   ```
   å®¹å™¨è©³æƒ… â†’ Network â†’ Published ports
   æ‡‰è©²çœ‹åˆ°ï¼š0.0.0.0:8082 â†’ 8082/tcp
   ```

2. **æª¢æŸ¥é˜²ç«ç‰†**
   ```bash
   # åœ¨ä¸»æ©ŸåŸ·è¡Œ
   sudo ufw status
   sudo ufw allow 8082
   ```

3. **æ¸¬è©¦é€£æ¥**
   ```
   å®¹å™¨ Console â†’ åŸ·è¡Œï¼š
   curl http://localhost:8082
   ```

### å®¹å™¨å¥åº·æª¢æŸ¥å¤±æ•—

1. **æŸ¥çœ‹å¥åº·æª¢æŸ¥æ—¥èªŒ**
   ```
   å®¹å™¨è©³æƒ… â†’ Inspect â†’ Health status
   ```

2. **æ‰‹å‹•æ¸¬è©¦å¥åº·æª¢æŸ¥**
   ```bash
   # åœ¨å®¹å™¨ Console åŸ·è¡Œ
   curl -f http://localhost:8082/api/model_status
   ```

3. **é‡å•Ÿæœå‹™**
   ```
   å®¹å™¨ Console â†’ åŸ·è¡Œï¼š
   pkill -f python3
   python3 /app/web_interface.py
   ```

---

## ğŸ“Š ç›£æ§å„€è¡¨æ¿

### è¨­ç½®è‡ªè¨‚å„€è¡¨æ¿

1. **å®‰è£ç›£æ§å·¥å…·**
   ```
   å·¦å´é¸å–® â†’ App Templates â†’ Prometheus + Grafana
   ```

2. **é…ç½®æ•¸æ“šæº**
   - æ·»åŠ  Docker ä½œç‚ºæ•¸æ“šæº
   - é…ç½®å®¹å™¨æŒ‡æ¨™æ”¶é›†

3. **å¸¸ç”¨ç›£æ§æŒ‡æ¨™**
   - CPU ä½¿ç”¨ç‡è¶¨å‹¢
   - è¨˜æ†¶é«”ä½¿ç”¨è¶¨å‹¢
   - ç¶²è·¯æµé‡
   - å®¹å™¨é‡å•Ÿæ¬¡æ•¸
   - å¥åº·æª¢æŸ¥ç‹€æ…‹

---

## ğŸ” å®‰å…¨è¨­å®š

### 1. é™åˆ¶å®¹å™¨æ¬Šé™

```yaml
# docker-compose.yml æ·»åŠ 
security_opt:
  - no-new-privileges:true
read_only: false  # STL ç³»çµ±éœ€è¦å¯«å…¥æ¬Šé™
```

### 2. è¨­å®šè³‡æºé…é¡

å·²é…ç½®ï¼š
```yaml
deploy:
  resources:
    limits:
      cpus: '4.0'
      memory: 8G
```

### 3. ç¶²è·¯éš”é›¢

```
å·¦å´é¸å–® â†’ Networks â†’ å‰µå»ºæ–°ç¶²è·¯
å°‡å®¹å™¨åŠ å…¥å°ˆç”¨ç¶²è·¯
```

---

## ğŸ“± Portainer è¡Œå‹•ç‰ˆæ“ä½œ

### é€éæ‰‹æ©Ÿ/å¹³æ¿è¨ªå•

1. **å®‰è£ Portainer App**ï¼ˆiOS/Androidï¼‰
2. **æ·»åŠ ç’°å¢ƒ**
   - è¼¸å…¥ Portainer URL
   - ç™»å…¥å¸³è™Ÿ
3. **ç®¡ç†å®¹å™¨**
   - æŸ¥çœ‹ç‹€æ…‹
   - é‡å•Ÿå®¹å™¨
   - æŸ¥çœ‹æ—¥èªŒ

---

## ğŸ”— å¿«é€Ÿé€£çµ

### å¸¸ç”¨ URL

| åŠŸèƒ½ | URL |
|------|-----|
| **Portainer** | http://localhost:9000 |
| **STL ç³»çµ±** | http://localhost:8082 |
| **å®¹å™¨æ—¥èªŒ** | Portainer â†’ Containers â†’ stl-object-detection â†’ Logs |
| **å¥åº·æª¢æŸ¥** | http://localhost:8082/api/model_status |

---

## ğŸ’¡ æœ€ä½³å¯¦è¸

### 1. å®šæœŸå‚™ä»½

```bash
# æ¯é€±å‚™ä»½è¨“ç·´çµæœ
docker exec stl-object-detection tar -czf /app/backup_$(date +%Y%m%d).tar.gz /app/runs
docker cp stl-object-detection:/app/backup_*.tar.gz ./backups/
```

### 2. ç›£æ§è³‡æºä½¿ç”¨

- å®šæœŸæŸ¥çœ‹ Stats æ¨™ç±¤
- è¨­å®šè¨˜æ†¶é«”/CPU ä½¿ç”¨è­¦å ±
- ç›£æ§ç£ç¢Ÿç©ºé–“ï¼ˆ/app/runs è³‡æ–™å¤¾ï¼‰

### 3. æ—¥èªŒç®¡ç†

```bash
# æ¸…ç†èˆŠæ—¥èªŒ
docker exec stl-object-detection find /app -name "*.log" -mtime +30 -delete
```

### 4. å®šæœŸæ›´æ–°

```bash
# æ›´æ–°å®¹å™¨
cd /home/aken/code/STL
docker-compose down
docker-compose pull  # å¦‚æœä½¿ç”¨é ç«¯æ˜ åƒ
docker-compose build  # é‡æ–°æ§‹å»º
docker-compose up -d
```

---

## ğŸ“ æ”¯æ´è³‡è¨Š

### æŸ¥çœ‹å®¹å™¨ç‰ˆæœ¬

```bash
docker exec stl-object-detection python3 -c "import ultralytics; print(ultralytics.__version__)"
```

### æŸ¥çœ‹ç³»çµ±è³‡è¨Š

```bash
docker exec stl-object-detection python3 -c "import sys; print(sys.version)"
```

### æª¢æŸ¥ä¾è³´å¥—ä»¶

```bash
docker exec stl-object-detection pip list
```

---

## âœ… æª¢æŸ¥æ¸…å–®

éƒ¨ç½²å¾Œç¢ºèªï¼š

- [ ] å®¹å™¨ç‹€æ…‹ç‚º "running"ï¼ˆç¶ è‰²ï¼‰
- [ ] å¥åº·æª¢æŸ¥ç‚º "healthy"
- [ ] å¯ä»¥è¨ªå• http://localhost:8082
- [ ] API ç«¯é»æ­£å¸¸ï¼šhttp://localhost:8082/api/model_status
- [ ] æ—¥èªŒæ²’æœ‰åš´é‡éŒ¯èª¤
- [ ] å·æ›è¼‰æ­£ç¢º
- [ ] è³‡æºä½¿ç”¨æ­£å¸¸ï¼ˆCPU < 80%, Memory < 6GBï¼‰

---

**ğŸ“š æ›´å¤šæ–‡æª”**ï¼š
- [DOCKER_README.md](DOCKER_README.md) - Docker å®Œæ•´æ–‡æª”
- [DOCKER_QUICKSTART.md](DOCKER_QUICKSTART.md) - å¿«é€Ÿå•Ÿå‹•æŒ‡å—
- [README_DOCKER.md](README_DOCKER.md) - å°ˆæ¡ˆç¸½è¦½